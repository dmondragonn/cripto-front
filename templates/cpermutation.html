<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="description" content="" />
    <meta name="author" content="" />

    <title>Cifrado de permutación</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;600;700&family=Open+Sans&display=swap"
      rel="stylesheet"
    />
    <link href="../static/css/bootstrap.min.css" rel="stylesheet" />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css"
      rel="stylesheet"
    />
    <link href="../static/css/templatemo-topic-listing.css" rel="stylesheet" />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css"
      rel="stylesheet"
    />
  </head>

  <body id="top">
    <main>
      <nav class="navbar navbar-expand-lg">
        <div class="container">
          <a class="navbar-brand" href="{{ url_for('index') }}">
            <i class="bi bi-person-lock"></i>
            <span>CryptoPlayground</span>
          </a>

          <div class="d-lg-none ms-auto me-4">
            <a href="#top" class="navbar-icon bi-person smoothscroll"></a>
          </div>

          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarNav"
            aria-controls="navbarNav"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>

          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-lg-5 me-lg-auto">
              <li class="nav-item">
                <a class="nav-link click-scroll" href="/">Inicio</a
                >
              </li>

              <li class="nav-item">
                <a class="nav-link click-scroll" href="/"
                  >Explorar cifrados</a
                >
              </li>

              <li class="nav-item">
                <a class="nav-link click-scroll" href="/ #section_3"
                  >Cómo funciona</a
                >
              </li>

              <li class="nav-item">
                <a class="nav-link click-scroll" href="{{ url_for('contact') }}">Nosotros</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>

        <header
          class="site-header d-flex flex-column justify-content-center align-items-center">
          <div class="container">
            <div class="row justify-content-center align-items-center">
              <div class="col-lg-5 col-12 mb-5">
                <nav aria-label="breadcrumb">
                  <ol class="breadcrumb">
                    <li class="breadcrumb-item">
                      <a href="{{ url_for('index') }}">Inicio</a>

                    <li class="breadcrumb-item active" aria-current="page">
                      Cifrado de permutación
                    </li>
                  </ol>
                </nav>

                <h2 class="text-white">Cifrado de permutación<br /></h2>

                <div class="d-flex align-items-center mt-5">
                  <a
                    href="#playground"
                    class="btn custom-btn custom-border-btn smoothscroll me-4"
                    >Playground!</a
                  >
                </div>
              </div>

              <div class="col-lg-5 col-12">
                <div class="topics-detail-block bg-white shadow-lg">
                  <img
                    src="../static/images/topics/permutation.png"
                    class="topics-detail-block-image img-fluid"
                  />
                </div>
              </div>
            </div>
          </div>
        </header>
      
      
      <div class="row gy-4 justify-content-center">
        {% if encrypted_message %}
        <div class="col-lg-12 col-12">
          <div class="alert alert-success">
            <strong>Mensaje cifrado:</strong> {{ encrypted_message }}
          </div>
        </div>
        {% endif %}
      </div>

      <section class="topics-detail-section section-padding" id="biblio">
        <div class="container">
          <div class="row">
            <div class="col-lg-8 col-12 m-auto">
              <h3 class="mb-4">Cifrado de permutación</h3>

              <p>
                El cifrado por permutación es uno de los métodos criptográficos más antiguos y sencillos, basado en reordenar los caracteres de un mensaje según una clave secreta. 
                Su origen se remonta a técnicas utilizadas en la antigüedad, donde se ocultaba el significado real de un texto mediante el cambio de posición de sus elementos, lo 
                que evolucionó hacia lo que hoy conocemos como cifras de transposición.
              </p>
              <p>En términos teóricos, el proceso se fundamenta en los siguientes principios:</p>
              <ul>
                <li>
                  <strong>División en Bloques:</strong>
                  <p>El mensaje se segmenta en bloques de longitud fija, donde esta longitud se determina a partir del tamaño de la clave. Cada bloque se procesa de forma independiente.</p>
                </li>
                <li>
                  <strong>Definición de la Permutación:</strong>
                  <p>La clave consiste en una secuencia de números (por ejemplo, "3142") que, al ser transformada (restando 1 para pasar a índices basados en cero), define el orden en que se reordenarán los caracteres del bloque. Matemáticamente, si la clave es una permutación \( \pi \) sobre \(\{0, 1, \dots, n-1\}\), para un bloque \( P = [p_0, p_1, \dots, p_{n-1}] \), el bloque cifrado \( C \) se obtiene aplicando:</p>
                  <p style="text-align: center;">\( C[i] = P[\pi(i)] \)</p>
                </li>
                <li>
                  <strong>Proceso de Encriptación:</strong>
                  <p>Cada bloque del texto se ajusta (rellenando si es necesario) para tener una longitud uniforme. Luego, los caracteres se reordenan de acuerdo con la permutación derivada de la clave, generando así el texto cifrado.</p>
                </li>
                <li>
                  <strong>Proceso de Desencriptación:</strong>
                  <p>La recuperación del mensaje original se basa en calcular la inversa de la permutación utilizada. Esto permite reorganizar cada bloque del texto cifrado en su orden original, eliminando cualquier relleno añadido durante la encriptación.</p>
                </li>
              </ul>

            </div>
          </div>
        </div>
      </section>

      <section class="section-padding section-bg" id="playground">
        <div class="container">
            <div class="row justify-content-center text-center">
                <div class="col-lg-12 col-12">
                    <h3 class="mb-4 pb-2">Playground!</h3>
                </div>
                
                <div class="col-lg-8 col-12">
                    <!-- Sección de generación de llaves -->
                    <div class="mb-5 p-4 bg-light" style="border-radius: 35px;">
                        <h5 class="mb-4">Gestión de Llaves</h5>
                        <div class="row g-3">
                            <div class="col-12">
                                <textarea id="generatedPublicKey" 
                                    class="form-control public-key-field" 
                                    placeholder="Llave pública generada aquí"
                                    readonly
                                    style="height: 100px; border-radius: 20px;"></textarea>
                            </div>
                            
                            <div class="col-12">
                                <textarea id="generatedPrivateKey" 
                                    class="form-control private-key-field" 
                                    placeholder="Llave privada generada aquí"
                                    readonly
                                    style="height: 100px; border-radius: 20px;"></textarea>
                            </div>
                            
                            <div class="col-12">
                                <button onclick="generar_llaves()" 
                                    class="btn btn-outline-primary rounded-pill px-4">
                                    Generar Nuevas Llaves
                                </button>
                            </div>
                        </div>
                    </div>
    
                    <!-- Selector de acción -->
                    <form id="cipherForm" class="custom-form contact-form">
                        <div class="row gy-4 justify-content-center">
                            <div class="col-lg-12 col-12">
                                <div class="btn-group" role="group">
                                    <input type="radio" class="btn-check" name="action" 
                                        id="encryptRadio" value="encrypt" 
                                        onchange="toggleUploadMenu()" checked>
                                    <label class="btn btn-outline-primary rounded-pill px-4 mx-2" 
                                        for="encryptRadio">Encriptar</label>
    
                                    <input type="radio" class="btn-check" name="action" 
                                        id="decryptRadio" value="decrypt" 
                                        onchange="toggleUploadMenu()">
                                    <label class="btn btn-outline-primary rounded-pill px-4 mx-2" 
                                        for="decryptRadio">Desencriptar</label>
                                </div>
                            </div>
    
                            <!-- Sección de Cifrado -->
                            <div id="encryptMenu" class="col-lg-12 col-12">
                                <div class="form-floating mt-3">
                                    <textarea class="form-control" id="encryptMessage" 
                                        placeholder="Escribe aquí..." 
                                        style="height: 100px; border-radius: 20px;"></textarea>
                                    <label for="encryptMessage">Texto a cifrar</label>
                                </div>
                                
                                <div class="form-floating mt-3">
                                    <textarea id="encryptPublicKey" 
                                        class="form-control public-key-field"
                                        placeholder="Ingrese llave pública"
                                        style="height: 100px; border-radius: 20px;"></textarea>
                                    <label for="encryptPublicKey">Llave Pública</label>
                                </div>
                            </div>
    
                            <!-- Sección de Descifrado -->
                            <div id="decryptMenu" class="col-lg-12 col-12" style="display: none;">
                                <div class="form-floating mt-3">
                                    <textarea class="form-control" id="decryptCiphertext" 
                                        placeholder="Escribe aquí..."
                                        style="height: 100px; border-radius: 20px;"></textarea>
                                    <label for="decryptCiphertext">Texto cifrado (formato c1,c2)</label>
                                </div>
                                
                                <div class="form-floating mt-3">
                                    <textarea id="decryptPrivateKey" 
                                        class="form-control private-key-field"
                                        placeholder="Ingrese llave privada"
                                        style="height: 100px; border-radius: 20px;"></textarea>
                                    <label for="decryptPrivateKey">Llave Privada</label>
                                </div>
                            </div>
    
                            <div class="col-lg-6 col-12 mt-4">
                                <button type="button" 
                                    onclick="handleProcess()" 
                                    class="btn btn-primary rounded-pill w-100 py-2">
                                    Procesar
                                </button>
                            </div>
                        </div>
                    </form>
    
                    <!-- Resultados -->
                    <div id="resultContainer" class="mt-4 p-4 bg-light" style="border-radius: 35px; display: none;">
                        <h5 class="mb-3">Resultado:</h5>
                        <div class="input-group">
                            <textarea id="encryptedMessage" 
                                class="form-control" 
                                readonly
                                style="height: 100px; border-radius: 20px;"></textarea>
                            <button class="btn btn-outline-secondary ms-2 rounded-pill" 
                                id="copyEncrypted">Copiar</button>
                        </div>
                        
                        <div class="input-group mt-4">
                            <textarea id="decryptedMessage" 
                                class="form-control" 
                                readonly
                                style="height: 100px; border-radius: 20px;"></textarea>
                            <button class="btn btn-outline-secondary ms-2 rounded-pill" 
                                id="copyDecrypted">Copiar</button>
                        </div>
                        
                        <span id="copyMessage" class="text-success mt-2" style="display: none;">
                            ¡Copiado al portapapeles!
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </section>
    </main>

    <script src="../static/js/jquery.min.js"></script>
    <script src="../static/js/bootstrap.bundle.min.js"></script>
    <script src="../static/js/jquery.sticky.js"></script>
    <script src="../static/js/custom.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  </body>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
        document.getElementById("cipherForm").addEventListener("submit", async (e) => {
            e.preventDefault();
            
            const message = document.getElementById("message").value;
            const key = document.getElementById("key").value;
            const action = document.querySelector('input[name="action"]:checked').value;
            const resultElement = document.getElementById("resultText");
            const copyBtn = document.getElementById("copyBtn");

            try {
                const response = await fetch("/process-permutation", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ 
                        message: message,
                        key: key,
                        action: action,
                        longitud_original: message.length  // Enviar longitud original
                    })
                });

                const data = await response.json();
                
                if (!response.ok) throw new Error(data.error || "Error del servidor");
                
                resultElement.textContent = data.result;
                resultElement.classList.remove("text-danger");
                resultElement.classList.add("text-primary");

                // Mostrar botón y habilitarlo
                copyBtn.disabled = false;
            } catch (error) {
                resultElement.textContent = `Error: ${error.message}`;
                resultElement.classList.remove("text-primary");
                resultElement.classList.add("text-danger");
                console.error("Error:", error);
            }
        });

        // Función para copiar texto al portapapeles
        document.getElementById("copyBtn").addEventListener("click", () => {
            const resultText = document.getElementById("resultText").textContent;
            const copyMessage = document.getElementById("copyMessage");

            navigator.clipboard.writeText(resultText).then(() => {
                copyMessage.style.display = "inline"; // Mostrar mensaje de copiado
                setTimeout(() => copyMessage.style.display = "none", 2000); // Ocultar mensaje después de 2s
            }).catch(err => console.error("Error al copiar:", err));
        });
    });

    document.addEventListener("DOMContentLoaded", function () {
        const resultadoDiv = document.getElementById("resultado");
        const procesarBtn = document.getElementById("procesarBtn");

        // Ocultar el div al cargar la página
        resultadoDiv.style.display = "none";

        procesarBtn.addEventListener("click", function () {
            // Mostrar el div de resultado
            resultadoDiv.style.display = "block";
        });
    });
</script>

</html>
